!function(){"use strict";var e=window.wp.element,t=window.lodash,l=window.wp.i18n,o=window.wp.blocks,s=window.wp.blockEditor,n=window.wp.components,r=window.wp.compose,c=window.wp.hooks;let i=null;window.otterCSSLintIgnored=[];var a=(0,e.memo)((t=>{let{attributes:o,setAttributes:s,clientId:r}=t;const c=(0,e.useRef)(null),[a,u]=(0,e.useState)([]),[d,m]=(0,e.useState)(null),[p,w]=(0,e.useState)(null),S=()=>{const e=r.substr(0,8);return(null==d?void 0:d.replace(/\s+/g,""))==="selector {\n}\n".replace(/\s+/g,"")?o.className:o.className?o.className.includes("ticss-")?o.className:[...o.className.split(" "),`ticss-${e}`].join(" "):`ticss-${e}`},v=function(e){var t,l,o,s,n,r,c;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=null==e||null===(t=e.state)||void 0===t||null===(l=t.lint)||void 0===l||null===(o=l.marked)||void 0===o||null===(s=o.filter((e=>{let{__annotation:t}=e;return"error"===(null==t?void 0:t.severity)})))||void 0===s?void 0:s.map((e=>{let{__annotation:t}=e;return null==t?void 0:t.message}));i&&0<(null===(n=a)||void 0===n?void 0:n.length)&&(window.otterCSSLintIgnored=a),a=null===(r=a)||void 0===r?void 0:r.filter((e=>!window.otterCSSLintIgnored.includes(e))),u(a),!i&&0<(null===(c=a)||void 0===c?void 0:c.length)||w(null==e?void 0:e.getValue())};return(0,e.useEffect)((()=>{var e;const t=o.customCSS&&null!==(e=o.className)&&void 0!==e&&e.includes("ticss-")?o.className.split(" ").find((e=>e.includes("ticss"))):null;let l="selector {\n}\n";if(o.customCSS){const e=new RegExp("."+t,"g");l=o.customCSS.replace(e,"selector")}c.current=wp.CodeMirror(document.getElementById("o-css-editor"),{value:l,autoCloseBrackets:!0,continueComments:!0,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,lint:!0,gutters:["CodeMirror-lint-markers"],styleActiveLine:!0,styleActiveSelected:!0,mode:"css",extraKeys:{"Ctrl-Space":"autocomplete","Alt-F":"findPersistent","Cmd-F":"findPersistent"}}),c.current.on("change",(()=>{clearTimeout(i),i=setTimeout((()=>{v(c.current)}),500)}))}),[]),(0,e.useEffect)((()=>{const e=new RegExp("selector","g");m(null==p?void 0:p.replace(e,`.${S().split(" ").find((e=>e.includes("ticss")))}`))}),[p]),(0,e.useEffect)((()=>{"selector {\n}\n".replace(/\s+/g,"")!==(null==d?void 0:d.replace(/\s+/g,""))?d&&s({customCSS:d}):s({customCSS:null})}),[d]),(0,e.useEffect)((()=>{s({hasCustomCSS:!0,className:S()})}),[o]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,l.__)("Add your custom CSS.","otter-blocks")),(0,e.createElement)("div",{id:"o-css-editor",className:"o-css-editor"}),0<(null==a?void 0:a.length)&&(0,e.createElement)("div",{className:"o-css-errors"},(0,e.createElement)(n.Notice,{status:"error",isDismissible:!1},(0,l.__)("Attention needed! We found following errors with your code:","otter-blocks")),(0,e.createElement)("pre",null,(0,e.createElement)("ul",null,a.map(((t,l)=>(0,e.createElement)("li",{key:l},t))))),(0,e.createElement)(n.Button,{variant:"secondary",onClick:()=>v(c.current,!0),style:{width:"max-content",marginBottom:"20px"}},(0,l.__)("Override","otter-blocks"))),(0,e.createElement)("p",null,(0,l.__)("Use","otter-blocks")," ",(0,e.createElement)("code",null,"selector")," ",(0,l.__)("to target block wrapper.","otter-blocks")),(0,e.createElement)("br",null),(0,e.createElement)("p",null,(0,l.__)("Example:","otter-blocks")),(0,e.createElement)("pre",{className:"o-css-editor-help"},"selector {\n    background: #000;\n}\n\nselector img {\n    border-radius: 100%;\n}"),(0,e.createElement)("p",null,(0,l.__)("You can also use other CSS syntax here, such as media queries.","otter-blocks")))})),u=window.wp.data;let d=!0;const m=e=>{var t;const l=null===(t=window.parent.document.querySelector('iframe[name="editor-canvas"]'))||void 0===t?void 0:t.contentWindow;let o=(null==l?void 0:l.document.head)||document.head,s=o.querySelector("#o-css-editor-styles");return d&&l?(l.addEventListener("DOMContentLoaded",(function(){setTimeout((()=>{m(e)}),500)})),void(d=!1)):(null===s&&(s=document.createElement("style"),s.setAttribute("type","text/css"),s.setAttribute("id","o-css-editor-styles"),null==o||o.appendChild(s)),s.textContent===e?null:s.textContent=e)},p=(e,l)=>{if(!e)return"";const s=e=>{const t=[];if("core/block"===e.name&&null!==l){const n=l.find((t=>e.attributes.ref===t.id));if(n&&n.content){const e=n.content.hasOwnProperty("raw")?n.content.raw:n.content;t.push((0,o.parse)(e).map((e=>[e,s(e)])))}}return void 0!==e.innerBlocks&&0<e.innerBlocks.length&&t.push(e.innerBlocks.map((e=>[e,s(e)]))),t},n=e.map((e=>[e,s(e)]));return(0,t.flattenDeep)(n).map((e=>e.attributes&&e.attributes.hasCustomCSS&&e.attributes.customCSS&&null!==e.attributes.customCSS?e.attributes.customCSS+"\n":"")).reduce(((e,t)=>e+t),"")};let w=[],S=!1;var v,b;(0,u.subscribe)((()=>{const{getBlocks:e}=(0,u.select)("core/block-editor"),l=!!(0,u.select)("core/edit-post")&&(0,u.select)("core/edit-post").__experimentalGetPreviewDeviceType(),o=e(),s=(0,u.select)("core").getEntityRecords("postType","wp_block",{context:"view"});if(!(0,t.isEqual)(w,o)||S!==l){const e=p(o,s);e&&(S!==l&&"Desktop"===S?setTimeout((()=>{m(e)}),500):m(e)),w=o,S=l}}));const C=t=>{let{clientId:o,setAttributes:s,attributes:r}=t;return(0,e.createElement)(n.PanelBody,{title:(0,l.__)("Custom CSS","otter-blocks"),initialOpen:!1},(0,e.createElement)(a,{clientId:o,setAttributes:s,attributes:r}),(0,e.createElement)("div",{className:"o-fp-wrap"},(0,c.applyFilters)("otter.feedback","","custom-css"),(0,c.applyFilters)("otter.poweredBy","")))},E=(0,r.createHigherOrderComponent)((t=>l=>(0,o.hasBlockSupport)(l.name,"customClassName",!0)&&l.isSelected?(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t,l),(0,e.createElement)(s.InspectorControls,null,(0,e.createElement)(C,l))):(0,e.createElement)(t,l)),"withInspectorControl");(0,c.addFilter)("blocks.registerBlockType","themeisle-custom-css/attribute",(e=>((0,o.hasBlockSupport)(e,"customClassName",!0)&&(e.attributes=(0,t.assign)(e.attributes,{hasCustomCSS:{type:"boolean",default:!1},customCSS:{type:"string",default:null}})),e))),Boolean(null===(v=window)||void 0===v||null===(b=v.blocksCSS)||void 0===b?void 0:b.hasOtter)?(0,c.addFilter)("otter.blockTools","themeisle-custom-css/with-inspector-controls",((t,s)=>(0,o.hasBlockSupport)(s.name,"customClassName",!0)?(0,e.createElement)(e.Fragment,null,t,(0,e.createElement)(n.__experimentalToolsPanelItem,{hasValue:()=>{var e;return Boolean(null===(e=s.attributes)||void 0===e?void 0:e.hasCustomCSS)},label:(0,l.__)("Custom CSS","otter-blocks"),onDeselect:()=>{s.setAttributes({hasCustomCSS:!1,customCSS:null}),(()=>{const{getBlocks:e}=(0,u.select)("core/block-editor"),t=e(),l=(0,u.select)("core").getEntityRecords("postType","wp_block",{context:"view"}),o=p(t,l);m(o)})()},isShownByDefault:!1},(0,e.createElement)(C,s))):t),2):(0,c.addFilter)("editor.BlockEdit","themeisle-custom-css/with-inspector-controls",E)}();